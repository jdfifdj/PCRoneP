<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">公主连结8月一图流</title>
    <link rel="stylesheet" href="./css/html.css">
    <script>
        // 获取当前月份并更新标题
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const month = now.getMonth() + 1; // getMonth()返回0-11
            const monthName = month + '月';
            
            // 更新title标签
            document.getElementById('page-title').textContent = 'Q群bot帮助' + monthName + '一图流';
            
            // 更新h1标签
            document.querySelector('h1').textContent = 'Q群bot帮助' + monthName + '一图流';
        });
    </script>
    <style>
        
    </style>
</head>

<body>
    <div id="app">
        <div class="container">
            <h1>公主连结8月一图流</h1>
            <!-- 背景图片 -->

            <!-- 表格数据 -->


            <!-- 倒计时显示 -->
           

            <!-- 动态活动表格 -->


            <!-- 修改卡池表格表头 -->
            <div class="card">
                <table>
                    <tr>
                        <th colspan="2" style="background-color: red;"> <!-- 修改colspan为3 -->
                            <h2 style="color: yellow;">BOT常用指令</h2>
                        </th>
                    </tr>
                    <tr>
                        <th>指令名称</th>
                        
                        <th>指令解释</th>
                    </tr>
                    <!-- 为卡池添加时间控制 -->
                    <tr v-for="(pool, index) in gachaPools" :key="`gacha-${index}`" v-show="pool.shouldShow">
                        
                        <th v-html="highlightText(pool.name)"></th>
                        <!-- 
                        <td>
                            <div class="activity-countdown" v-html="highlightText(pool.name)" >
                                {{ formatDate(pool.name) }}
                                
                                 
                            </div>
                            
                           <div class="activity-countdown" :class="getCountdownText(pool).class">
                                {{ getCountdownText(pool).text }}
                            </div>
                            
                        </td>
                         -->
                        <!-- 新增状态单元格 -->
                        <th v-html="highlightText(pool.advice)"></th>
                    </tr>
                </table>
            </div>

            <!-- 本月六星 -->


            <!-- 专武表格 -->
            <!-- 专武部分 - 应用增大尺寸的样式 -->


            <!-- 活动赠送角色 -->


            <div style="text-align:center;">
                <a href="./index.html" style="color:red;text-decoration:none;">
                    <h3>点击返回首页</h3>
                </a>
            </div>

        </div>

        <footer>
            <p>BOT来源</p>
            <p><a href="https://github.com/Ice9Coffee/HoshinoBot">github：HoshinoBot</p>
            <p><a href="https://github.com/jdfifdj/PCRoneP">项目地址：Github</p>
            <p><a href="https://console.tencentcloud.com/edgeone">网站搭建：EdgeOne</p>
        </footer>

        <!-- 图片预览弹窗 -->
        <div class="modal" id="imageModal" v-if="showModal">
            <div class="modal-content">
                <span class="close-btn" @click="closeImageModal">&times;</span>
                <img :src="modalImage" alt="预览" style="max-width: 100%; max-height: 90vh;">
            </div>
        </div>
    </div>
    <script src="./bothelp.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.6.14/vue.min.js"></script>
    <script>
        // 定义分类映射
        const categoryMap = {
            './图标/主线关卡.png': 1,
            './图标/困难关卡.png': 1,
            './图标/圣迹调查.png': 1,
            './图标/探索.png': 1,
            './图标/大师币.png': 1,
            './图标/庆典.png': 2,
            './图标/露娜塔.png': 2,
            './图标/地下城.png': 2,
            './图标/团队战.png': 2,
            './图标/竞技场.png': 2,
            './图标/扭蛋.png': 3,
            './图标/宝箱.png': 4,
            './图标/妈.png': 4
        };

        // 分类名称映射
        const categoryNames = {
            1: '探索类',
            2: '活动类',
            3: '抽卡类',
            4: '庆典类'
        };

        new Vue({
            el: '#app',
            data: {
                ...configData,
                categoryMap: categoryMap,
                categoryNames: categoryNames
            },
            computed: {
                // 按分类排序后的活动
                sortedActivities() {
                    return [...this.activities]
                        .filter(activity => activity.shouldShow)
                        .sort((a, b) => {
                            const categoryA = this.categoryMap[a.icon] || 999;
                            const categoryB = this.categoryMap[b.icon] || 999;

                            if (categoryA !== categoryB) {
                                return categoryA - categoryB;
                            }

                            // 同类活动按开始时间排序
                            return new Date(a.start) - new Date(b.start);
                        });
                },
                // 按分类分组的活动
                groupedActivities() {
                    const groups = {};
                    this.sortedActivities.forEach(activity => {
                        const category = this.categoryMap[activity.icon] || 999;
                        if (!groups[category]) {
                            groups[category] = [];
                        }
                        groups[category].push(activity);
                    });
                    return groups;
                }
            },
            methods: {
                updateCurrentTime() {
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    const seconds = String(now.getSeconds()).padStart(2, '0');

                    this.currentTime = `${year} 年 ${month} 月 ${day} 日 ${hours}:${minutes}:${seconds}`;
                },

                // 添加缺失的getCountdownText函数
                getCountdownText(activity) {
                    const now = new Date();
                    const start = new Date(activity.start);
                    const end = new Date(activity.end);
                    const oneDay = 24 * 60 * 60 * 1000;
                    const oneHour = 60 * 60 * 1000;
                    const oneMinute = 60 * 1000;

                    // 检查是否是专武
                    const isSpecialWeapon = activity.category === 'specialWeapon';

                    if (now < start) {
                        const diff = start - now;
                        const days = Math.floor(diff / oneDay);
                        const hours = Math.floor((diff % oneDay) / oneHour);
                        const minutes = Math.floor((diff % oneHour) / oneMinute);

                        if (isSpecialWeapon) {
                            // 专武未开始
                            return {
                                class: 'countdown-unstarted',
                                text: `距开专还有: ${days}天${hours}小时${minutes}分`
                            };
                        } else {
                            // 活动未开始
                            return {
                                class: 'countdown-unstarted',
                                text: `距开始: ${days}天${hours}小时${minutes}分`
                            };
                        }
                    } else if (now > end) {
                        const diff = end - start;
                        const totalDays = Math.floor(diff / oneDay);
                        const totalHours = Math.floor((diff % oneDay) / oneHour);
                        const totalMinutes = Math.floor((diff % oneHour) / oneMinute);

                        const daysAfterEnd = Math.floor((now - end) / oneDay);

                        if (isSpecialWeapon) {
                            // 专武已结束
                            return {
                                class: 'countdown-ended',
                                text: `本月已开专时间: ${totalDays}天${totalHours}小时${totalMinutes}分 (已结束: ${daysAfterEnd}天)`
                            };
                        } else {
                            // 活动已结束
                            return {
                                class: 'countdown-ended',
                                text: `已结束: ${daysAfterEnd}天`
                            };
                        }
                    } else {
                        const diff = now - start;
                        const days = Math.floor(diff / oneDay);
                        const hours = Math.floor((diff % oneDay) / oneHour);
                        const minutes = Math.floor((diff % oneHour) / oneMinute);

                        if (isSpecialWeapon) {
                            // 专武进行中
                            return {
                                class: 'countdown-ongoing',
                                text: `已开专时间： ${days}天${hours}小时${minutes}分`
                            };
                        } else {
                            // 活动进行中
                            const remainingDiff = end - now;
                            const remainingDays = Math.floor(remainingDiff / oneDay);
                            const remainingHours = Math.floor((remainingDiff % oneDay) / oneHour);
                            const remainingMinutes = Math.floor((remainingDiff % oneHour) / oneMinute);
                            return {
                                class: 'countdown-ongoing',
                                text: `剩余: ${remainingDays}天${remainingHours}小时${remainingMinutes}分`
                            };
                        }
                    }
                },

                highlightText(text) {
                    // 对每个关键词进行转义处理
                    this.highlightKeywords.forEach(item => {
                        const escapedKeyword = item.keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const regex = new RegExp(escapedKeyword, 'g');
                        text = text.replace(regex, `<span class="${item.className}">${item.keyword}</span>`);
                    });
                    return text;
                },
                formatDate(dateStr) {
                    return dateStr.replace(/(\d{4})\/(\d{2})\/(\d{2})/g, '$1年$2月$3日');
                },
                updateActivityStatus() {
                    const now = new Date();

                    // 更新活动状态
                    this.activities.forEach(activity => {
                        const start = new Date(activity.start);
                        const end = new Date(activity.end);

                        // 计算时间差（毫秒）
                        const daysBeforeStart = (start - now) / (1000 * 60 * 60 * 24);
                        const daysAfterEnd = (now - end) / (1000 * 60 * 60 * 24);

                        if (now < start) {
                            activity.status = 'unstarted';
                            activity.statusText = '未开始';
                            // 距离开始超过10天则隐藏
                            activity.shouldShow = daysBeforeStart <= 10;
                        } else if (now > end) {
                            activity.status = 'ended';
                            activity.statusText = '已结束';
                            // 距离结束超过2天则隐藏
                            activity.shouldShow = daysAfterEnd <= 0;
                        } else {
                            activity.status = 'ongoing';
                            activity.statusText = '进行中';
                            activity.shouldShow = true;
                        }
                    });

                    // 更新卡池显示状态
                    this.gachaPools.forEach(pool => {
                        const start = new Date(pool.start);
                        const end = new Date(pool.end);
                        const daysBeforeStart = (start - now) / (1000 * 60 * 60 * 24);
                        const daysAfterEnd = (now - end) / (1000 * 60 * 60 * 24); // 正确定义

                        if (now < start) {
                            pool.status = 'unstarted';
                            pool.statusText = '未开始';
                        } else if (now > end) {
                            pool.status = 'ended';
                            pool.statusText = '已结束';
                        } else {
                            pool.status = 'ongoing';
                            pool.statusText = '进行中';
                        }

                        // 开始前10天内显示，开始后2天内显示
                        pool.shouldShow = (daysBeforeStart <= 10 && daysBeforeStart > 0) ||
                            (daysAfterEnd <= 1 && daysAfterEnd >= 0) ||
                            (now >= start && now <= end);
                    });

                    this.sixStar.forEach(star => {
                        const start = new Date(star.start);
                        const end = new Date(star.end);
                        const daysBeforeStart = (start - now) / (1000 * 60 * 60 * 24);
                        const daysAfterEnd = (now - end) / (1000 * 60 * 60 * 24); // 新增

                        star.shouldShow = (daysBeforeStart <= 8 && daysBeforeStart > 0) ||
                            (daysAfterEnd <= 1 && daysAfterEnd >= 0) ||
                            (now >= start && now <= end);
                    });

                    this.huodong.forEach(role => {
                        const start = new Date(role.start);
                        const end = new Date(role.end);
                        const daysBeforeStart = (start - now) / (1000 * 60 * 60 * 24);
                        const daysAfterEnd = (now - end) / (1000 * 60 * 60 * 24); // 新增

                        role.shouldShow = (daysBeforeStart <= 2 && daysBeforeStart > 0) ||
                            (daysAfterEnd <= 1 && daysAfterEnd >= 0) ||
                            (now >= start && now <= end);
                    });

                    this.specialWeapons.forEach(weapon => {
                        const start = new Date(weapon.start);
                        const end = new Date(weapon.end);
                        const daysBeforeStart = (start - now) / (1000 * 60 * 60 * 24);
                        const daysAfterEnd = (now - end) / (1000 * 60 * 60 * 24); // 新增

                        weapon.shouldShow = (daysBeforeStart <= 7 && daysBeforeStart > 0) ||
                            (daysAfterEnd <= 0 && daysAfterEnd >= 0) ||
                            (now >= start && now <= end);
                    });

                },
                showImageModal(imageSrc) {
                    this.modalImage = imageSrc;
                    this.showModal = true;
                },
                closeImageModal() {
                    this.showModal = false;
                }
            },
            mounted() {
                // 初始化时间更新
                this.updateCurrentTime();
                setInterval(this.updateCurrentTime, 1000);

                // 初始化活动状态
                this.updateActivityStatus();
                // 每小时更新一次活动状态
                setInterval(this.updateActivityStatus, 3600000);
            }
        });
    </script>
</body>

</html>